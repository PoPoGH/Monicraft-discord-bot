# Monicraft - Bot Discord pour Serveurs Minecraft

Un bot Discord avanc√© pour g√©rer plusieurs serveurs Minecraft avec support pour les modpacks et cr√©ation d'annonces automatiques.

## üîß Fonctionnalit√©s

### 1. Gestion des Serveurs Minecraft
- Ajout dynamique de serveurs via la commande `/ajouter_serveur` avec support pour les modpacks
- Modification des informations d'un serveur existant avec `/modifier_serveur`
- Suppression de serveurs avec `/supprimer_serveur` (supprime √©galement les embeds associ√©s)
- V√©rification de l'√©tat des serveurs avec `/serveur`
- Affichage auto-actualis√© de l'√©tat des serveurs dans un salon avec `/afficher_serveur`
- Mode maintenance pour les serveurs avec `/maintenance_serveur`
- Persistance des donn√©es apr√®s red√©marrage du bot
- Annonce automatique lors de la mise √† jour de la version du modpack

### 2. Support des Modpacks
- Ajout de la version du modpack lors de la cr√©ation d'un serveur
- Ajout du lien vers le modpack pour faciliter le t√©l√©chargement
- Affichage des informations du modpack dans les embeds de statut
- Annonces automatiques avec @everyone lors des mises √† jour de modpack

### 3. Syst√®me d'Annonces
- Annonces automatiques avec @everyone lors des mises √† jour de modpack via `/modifier_serveur`
- Cr√©ation d'annonces manuelles personnalis√©es avec `/annonce` pour d'autres types d'informations (√©v√©nements, maintenances, etc.)
- Personnalisation du titre, de la description et de la couleur des annonces manuelles

## üìã Pr√©requis

- [Node.js](https://nodejs.org/) (v16.9.0 ou sup√©rieur)
- [npm](https://www.npmjs.com/) (inclus avec Node.js)
- Un [compte d√©veloppeur Discord](https://discord.com/developers/applications) pour cr√©er un bot

## üöÄ Installation

1. **Cloner le d√©p√¥t ou t√©l√©charger les fichiers**

2. **Installer les d√©pendances**
   ```bash
   npm install
   ```

3. **Configurer le bot**
   - Copiez `config.example.json` vers `config.json` et modifiez les valeurs :
     ```bash
     cp config.example.json config.json
     ```
   - √âditez le fichier `config.json` avec vos informations :
     ```json
     {
       "token": "VOTRE_TOKEN_DISCORD_ICI",
       "clientId": "ID_DE_VOTRE_BOT",
       "adminIds": ["ID_ADMIN_1", "ID_ADMIN_2"],
       "updateInterval": 300000,
       "embedColor": "#3498db",
       "devGuildIds": ["ID_SERVEUR_1", "ID_SERVEUR_2"],
       "isDev": false,
       "autoDeployCommands": true
     }
     ```
   - `token` : Le token de votre bot Discord (disponible sur le [portail d√©veloppeur Discord](https://discord.com/developers/applications))
   - `clientId` : L'ID de votre application Discord
   - `adminIds` : Les IDs Discord des utilisateurs autoris√©s √† ajouter des serveurs
   - `updateInterval` : Intervalle de mise √† jour des embeds en millisecondes (300000 = 5 minutes)
   - `embedColor` : Couleur par d√©faut des embeds
   - `devGuildIds` : Liste des IDs des serveurs de d√©veloppement o√π d√©ployer les commandes en mode dev
   - `isDev` : Activer le mode d√©veloppement (d√©ploiement des commandes uniquement sur les serveurs sp√©cifi√©s)
   - `autoDeployCommands` : D√©ployer automatiquement les commandes au d√©marrage du bot (true/false)

4. **D√©ployer ou supprimer les commandes slash**

   > **Note**: Si vous avez activ√© `autoDeployCommands` dans la configuration, les commandes seront automatiquement d√©ploy√©es au d√©marrage du bot. Vous n'avez pas besoin d'ex√©cuter ces commandes manuellement.

   ```bash
   # D√©ploiement global (pour tous les serveurs)
   node deploy-commands.js --global
   
   # D√©ploiement sur les serveurs de d√©veloppement configur√©s dans config.json
   node deploy-commands.js --dev
   
   # D√©ploiement sur un serveur sp√©cifique
   node deploy-commands.js --guild=ID_DU_SERVEUR
   
   # D√©ploiement sur plusieurs serveurs sp√©cifiques
   node deploy-commands.js --guild=ID_SERVEUR_1 --guild=ID_SERVEUR_2
   
   # Suppression de toutes les commandes globales
   node deploy-commands.js --delete --global
   
   # Suppression des commandes sur les serveurs de d√©veloppement
   node deploy-commands.js --delete --dev
   
   # Suppression des commandes d'un serveur sp√©cifique
   node deploy-commands.js --delete-guild=ID_DU_SERVEUR
   
   # Suppression des commandes de plusieurs serveurs sp√©cifiques
   node deploy-commands.js --delete-guild=ID_SERVEUR_1 --delete-guild=ID_SERVEUR_2
   ```
   
   > **Note**: Le d√©ploiement sur des serveurs sp√©cifiques est instantan√©, tandis que le d√©ploiement global peut prendre jusqu'√† une heure pour se propager. C'est pourquoi il est recommand√© d'utiliser le mode d√©veloppement pendant la phase de test.
   >
   > La suppression des commandes peut √™tre utile pour nettoyer les commandes obsol√®tes ou r√©initialiser compl√®tement le bot.

5. **D√©marrer le bot**
   ```bash
   node index.js
   ```

## üìù Commandes

### `/ajouter_serveur`
Ajoute un serveur Minecraft √† la liste des serveurs surveill√©s.
- **Utilisation** : `/ajouter_serveur nom:MonServeur ip:mc.monserveur.com port:25565 modpack_version:1.0 modpack_link:https://exemple.com/modpack`
- **Permissions** : R√©serv√© aux utilisateurs dont l'ID est dans `adminIds`
- **Options** :
  - `nom` : Nom du serveur (requis)
  - `ip` : Adresse IP ou domaine du serveur (requis)
  - `port` : Port du serveur (optionnel, par d√©faut: 25565)
  - `modpack_version` : Version du modpack utilis√© par le serveur (optionnel)
  - `modpack_link` : Lien vers le modpack utilis√© par le serveur (optionnel)

### `/modifier_serveur`
Modifie les informations d'un serveur existant.
- **Utilisation** : `/modifier_serveur nom:MonServeur champ:modpack_version valeur:1.1 salon_annonce:#annonces`
- **Permissions** : R√©serv√© aux utilisateurs dont l'ID est dans `adminIds`
- **Options** :
  - `nom` : Nom du serveur √† modifier (requis)
  - `champ` : Champ √† modifier (requis) - Choix: Adresse IP, Port, Version du modpack, Lien du modpack
  - `valeur` : Nouvelle valeur pour le champ (requis)
  - `salon_annonce` : Salon o√π envoyer l'annonce (optionnel, pour les mises √† jour de version)
- **Fonctionnalit√© sp√©ciale** : Lorsque la version du modpack est modifi√©e, une annonce avec @everyone est automatiquement envoy√©e

### `/supprimer_serveur`
Supprime un serveur de la liste des serveurs surveill√©s et tous les embeds associ√©s.
- **Utilisation** : `/supprimer_serveur nom:MonServeur confirmation:true`
- **Permissions** : R√©serv√© aux utilisateurs dont l'ID est dans `adminIds`
- **Options** :
  - `nom` : Nom du serveur √† supprimer (requis)
  - `confirmation` : Confirmation de la suppression (requis, doit √™tre true pour confirmer)
- **Fonctionnalit√© sp√©ciale** : Supprime √©galement tous les embeds Discord associ√©s au serveur

### `/serveur`
Affiche l'√©tat d'un serveur Minecraft.
- **Utilisation** : `/serveur nom:MonServeur`
- **Affiche** : IP, port, nombre de joueurs connect√©s, ping, √©tat du serveur, version du modpack, lien du modpack

### `/afficher_serveur`
Cr√©e un embed auto-actualis√© dans un salon.
- **Utilisation** : `/afficher_serveur nom:MonServeur salon:#√©tat-serveurs`
- **Fonctionnement** : L'embed est mis √† jour toutes les 5 minutes (configurable)

### `/annonce`
Cr√©e une annonce manuelle avec un embed personnalis√© (pour les √©v√©nements, maintenances, etc.).
- **Utilisation** : `/annonce salon:#annonces titre:√âv√©nement sp√©cial description:Un √©v√©nement aura lieu ce weekend ! couleur:GREEN`
- **Options** :
  - `salon` : Salon o√π envoyer l'annonce (requis)
  - `titre` : Titre de l'annonce (requis)
  - `description` : Description de l'annonce (requis)
  - `couleur` : Couleur de l'embed (optionnel) - Noms de couleurs Discord (RED, GREEN, BLUE, etc.) ou codes HEX (#ff0000)
- **Note** : Pour les annonces de mise √† jour de modpack, utilisez plut√¥t `/modifier_serveur` qui g√©n√®re automatiquement une annonce

### `/maintenance_serveur`
Met un serveur Minecraft en mode maintenance pour mise √† jour du modpack.
- **Utilisation** : `/maintenance_serveur nom:MonServeur activer:true raison:Mise √† jour du modpack salon_annonce:#annonces`
- **Permissions** : R√©serv√© aux utilisateurs dont l'ID est dans `adminIds`
- **Options** :
  - `nom` : Nom du serveur √† mettre en maintenance (requis)
  - `activer` : Activer (true) ou d√©sactiver (false) le mode maintenance (requis)
  - `raison` : Raison de la maintenance (optionnel)
  - `salon_annonce` : Salon o√π envoyer l'annonce de maintenance (optionnel)
- **Fonctionnalit√© sp√©ciale** : 
  - Affiche le serveur comme √©tant en maintenance dans les embeds auto-actualis√©s
  - Envoie une annonce avec @everyone pour informer les utilisateurs de la maintenance
  - Emp√™che la mise √† jour automatique du statut du serveur pendant la maintenance

### `/supprimer_message`
Supprime un message post√© par le bot (utile pour supprimer des annonces obsol√®tes).
- **Utilisation** : `/supprimer_message message_id:123456789012345678 salon:#annonces`
- **Permissions** : R√©serv√© aux utilisateurs dont l'ID est dans `adminIds`
- **Options** :
  - `message_id` : ID du message √† supprimer (requis)
  - `salon` : Salon o√π se trouve le message (optionnel, par d√©faut: salon actuel)
- **Note** : Le bot ne peut supprimer que ses propres messages

## üîÑ Red√©marrages et Maintenance

- Les donn√©es des serveurs sont stock√©es dans une base de donn√©es SQLite
- Les embeds auto-actualis√©s sont recr√©√©s automatiquement apr√®s un red√©marrage
- Les logs sont enregistr√©s dans le dossier `logs/`

## üõ†Ô∏è Structure du Projet

```
‚îú‚îÄ‚îÄ commands/                   # Commandes du bot
‚îÇ   ‚îú‚îÄ‚îÄ ajouter_serveur.js      # Commande pour ajouter un serveur
‚îÇ   ‚îú‚îÄ‚îÄ modifier_serveur.js     # Commande pour modifier un serveur existant
‚îÇ   ‚îú‚îÄ‚îÄ supprimer_serveur.js    # Commande pour supprimer un serveur
‚îÇ   ‚îú‚îÄ‚îÄ serveur.js              # Commande pour v√©rifier l'√©tat d'un serveur
‚îÇ   ‚îú‚îÄ‚îÄ afficher_serveur.js     # Commande pour cr√©er un embed auto-actualis√©
‚îÇ   ‚îú‚îÄ‚îÄ annonce.js              # Commande pour cr√©er une annonce
‚îÇ   ‚îú‚îÄ‚îÄ maintenance_serveur.js  # Commande pour mettre un serveur en maintenance
‚îÇ   ‚îú‚îÄ‚îÄ supprimer_message.js    # Commande pour supprimer un message du bot
‚îÇ   ‚îî‚îÄ‚îÄ index.js                # Gestionnaire de commandes
‚îú‚îÄ‚îÄ utils/                      # Utilitaires
‚îÇ   ‚îú‚îÄ‚îÄ minecraft.js            # Fonctions pour interagir avec les serveurs Minecraft
‚îÇ   ‚îî‚îÄ‚îÄ embeds.js               # Fonctions pour cr√©er des embeds Discord
‚îú‚îÄ‚îÄ data/                       # Dossier pour la base de donn√©es (cr√©√© automatiquement)
‚îú‚îÄ‚îÄ logs/                       # Dossier pour les logs (cr√©√© automatiquement)
‚îú‚îÄ‚îÄ config.json                 # Configuration du bot
‚îú‚îÄ‚îÄ database.js                 # Module de gestion de la base de donn√©es
‚îú‚îÄ‚îÄ deploy-commands.js          # Script pour d√©ployer les commandes slash
‚îú‚îÄ‚îÄ index.js                    # Point d'entr√©e du bot
‚îú‚îÄ‚îÄ package.json                # D√©pendances du projet
‚îî‚îÄ‚îÄ README.md                   # Documentation
```

## üìö D√©pendances Principales

- [discord.js](https://discord.js.org/) - API Discord pour Node.js
- [node-mcstatus](https://www.npmjs.com/package/node-mcstatus) - Utilitaire pour interagir avec les serveurs Minecraft
- [better-sqlite3](https://www.npmjs.com/package/better-sqlite3) - Base de donn√©es SQLite pour Node.js

## üîß Mode D√©veloppement

Le bot prend en charge un mode de d√©veloppement qui permet de d√©ployer les commandes slash uniquement sur des serveurs sp√©cifiques. Cela pr√©sente plusieurs avantages :

1. **Mise √† jour instantan√©e** : Les commandes d√©ploy√©es sur un serveur sp√©cifique sont disponibles imm√©diatement, contrairement au d√©ploiement global qui peut prendre jusqu'√† une heure.
2. **Tests isol√©s** : Vous pouvez tester vos modifications sur un serveur de d√©veloppement sans affecter les autres serveurs o√π le bot est utilis√©.
3. **D√©veloppement it√©ratif** : Modifiez et testez rapidement vos commandes pendant le d√©veloppement.

Pour utiliser le mode d√©veloppement :
1. Ajoutez les IDs de vos serveurs de d√©veloppement dans le tableau `devGuildIds` du fichier `config.json`
2. D√©finissez `isDev` sur `true` dans `config.json` ou utilisez l'option `--dev` lors du d√©ploiement
3. D√©ployez les commandes avec `node deploy-commands.js --dev`

Une fois le d√©veloppement termin√©, vous pouvez d√©ployer globalement avec `node deploy-commands.js --global`.

## ‚ö†Ô∏è R√©solution des Probl√®mes

- **Le bot ne r√©pond pas aux commandes** : V√©rifiez que les commandes slash ont √©t√© d√©ploy√©es avec `node deploy-commands.js`
- **Les commandes ne s'affichent pas imm√©diatement** : Si vous avez d√©ploy√© globalement, cela peut prendre jusqu'√† une heure. Utilisez le d√©ploiement sur un serveur sp√©cifique pour des tests imm√©diats.
- **Erreurs de connexion aux serveurs Minecraft** : V√©rifiez que l'IP et le port sont corrects
- **Probl√®mes de permissions** : Assurez-vous que le bot a les permissions n√©cessaires dans les salons (Envoyer des messages, Int√©grer des liens, Voir le salon)

## üîí S√©curit√©

Ce projet inclut un fichier `.gitignore` configur√© pour exclure les fichiers sensibles et les donn√©es personnelles :

- **Fichiers de configuration** : Le fichier `config.json` contenant le token Discord et d'autres informations sensibles est exclu du d√©p√¥t Git. Utilisez toujours `config.example.json` comme mod√®le et cr√©ez votre propre `config.json` localement.
- **Base de donn√©es** : Les fichiers de base de donn√©es SQLite (dans le dossier `data/`) sont exclus pour √©viter de partager des donn√©es utilisateur.
- **Logs** : Les fichiers de logs sont exclus pour √©viter de divulguer des informations sensibles.
- **D√©pendances** : Le dossier `node_modules/` est exclu pour r√©duire la taille du d√©p√¥t.

### Bonnes pratiques

1. **Ne jamais commiter de tokens ou cl√©s d'API** : Utilisez des variables d'environnement ou un fichier de configuration exclu du d√©p√¥t.
2. **V√©rifier r√©guli√®rement les d√©pendances** : Utilisez `npm audit` pour v√©rifier les vuln√©rabilit√©s dans les d√©pendances.
3. **Limiter les permissions du bot** : N'accordez au bot que les permissions Discord dont il a r√©ellement besoin.
4. **Restreindre l'acc√®s aux commandes d'administration** : Utilisez le syst√®me `adminIds` pour limiter qui peut ex√©cuter des commandes sensibles.

## ü§ù Contribution

N'h√©sitez pas √† am√©liorer ce bot en ajoutant de nouvelles fonctionnalit√©s ou en corrigeant des bugs !

Avant de soumettre une contribution :
1. Assurez-vous que votre code respecte les bonnes pratiques de s√©curit√©
2. Testez vos modifications en mode d√©veloppement
3. V√©rifiez que vous n'avez pas inclus de donn√©es sensibles dans vos commits
